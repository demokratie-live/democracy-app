env:
  global:
    secure: aJ8jCTs1VWdawdXWgd/0fZXxFGKOlOAb9YS7ijIdm2NSTJr+4jqK2CWQSgpyvHIdxNccvWtxrEB1azeocBHk9G+pJm2GTwR0cncaJUEo+lrJjOnNJzMk/mpIj0IpxzYt5vvlPnliuDpgXkwFZAhc9a7INMmrA2m9Y4be2EYn9Sa1vzB3grJO0JYxQgN1tcH3aPk1Q7eia/hQaECIaQ36o3VDQh0+rKbWAnLNQWHF+Rr9Gn7Y6QUcW+RJfxp77K3/6W4ZS67650kG3efEUTWw4b2zvdUqVRjhP7z9Jqjw0R5QuR2GVQUZzQliTuiAAVbiHlu/kpk6p05nMMClEm3yZoiGar1qE+LibDVT6si0Fsm9tmzCU5qCaz7GvAxbM5oBie9av0eUg1mQrRvWG10e7lHiNm+VC3jDRorf7AaNIQuQQpB/61w2IXiqFj5OHMV0BVYKItACM0u9dCGAgHICsEmNkNbW20anZiYAy3NrstYxmgP70nkwppmD3/lfzorGAw21SzZXe2ebdCM2cHf9G3cw6lk+jNhwo4YO211dcsF2sauZ5Ok31Yd7nWyDoxZShPwF0l1mJlHERPMXQUf6luGXWq+PAJ63y0Tp7EhZVGfZf7tHJz8IbxIVlBJ/5Ggv/FMYp9PolnHEJKifrzd5xHOY5j248d7nDQZkYCQj3kw=

cache:
  yarn: true
  directories:
    - "$HOME/.yarn-cache"
    - node_modules
    - packages/mobile-app/node_modules
    - packages/mobile-ui/node_modules
matrix:
  include:
    - language: swift
      os: osx
      osx_image: xcode11.1
      if: commit_message !~ /(no-deploy)/
      node_js: false
      before_install:
        - nvm install 10
        - node --version
        - npm install -g yarn
        - yarn -version
        - gem install fastlane
        - echo -e "machine github.com\n  login $GITHUB_API_TOKEN" >> ~/.netrc
      install:
        - yarn
        - yarn pods
        - cd packages/mobile-app/ios
        - bundle install
        - cd $TRAVIS_BUILD_DIR
      script:
        - cd packages/mobile-app/ios
        - bundle exec fastlane ios beta
        - cd $TRAVIS_BUILD_DIR
      after_success:
        - ".travis/push.sh"

    # Android
    - language: android
      if: commit_message !~ /(no-deploy)/
      os: linux
      jdk: oraclejdk8
      sudo: required
      android:
        components:
          - platform-tools
          - tools
          - build-tools-26.0.3
          - build-tools-28.0.3
          - android-21
          - android-26
          - android-28
          - sys-img-armeabi-v7a-android-21
          - extra-android-m2repository
          - extra-google-m2repository
          - extra-google-google_play_services
      node_js: false
      before_install:
        - echo $super_secret_password | gpg --passphrase-fd 0 packages/mobile-app/android/my-release-key.keystore.gpg
        - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo
          sysctl -p
        - nvm install 10
        - node --version
        - npm install -g yarn
        - yarn -version
        - gem install fastlane
        - echo -e "machine github.com\n  login $GITHUB_API_TOKEN" >> ~/.netrc
      install:
        - yarn
        - cd packages/mobile-app/android
        - bundle install
        - cd $TRAVIS_BUILD_DIR
      script:
        - cd packages/mobile-app/android
        - bundle exec fastlane android internal
        - cd $TRAVIS_BUILD_DIR
      after_success:
        - ".travis/push.sh"
